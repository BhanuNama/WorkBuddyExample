<div class="min-vh-100 py-4">
  <!-- Main Content -->
  <div class="container-fluid">
    <div class="card shadow-sm mx-auto">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="fw-bold mb-0">Leave Requests</h4>
          <div class="d-flex gap-2 align-items-center">
            <input 
              type="text" 
              class="form-control form-control-sm" 
              placeholder="Search by Reason"
              [(ngModel)]="searchValue"
              (input)="onSearch()"
              style="width: 250px;">
            <button class="btn btn-sm btn-outline-danger" (click)="logout()">
              <i class="bi bi-box-arrow-right"></i> Logout
            </button>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading leave requests...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && filteredRequests.length === 0" class="text-center py-5">
          <i class="bi bi-inbox fs-1 text-muted"></i>
          <p class="mt-3 text-muted">No leave requests found</p>
          <button class="btn btn-primary" (click)="goToApplyLeave()">Apply for Leave</button>
        </div>

        <!-- Table -->
        <div *ngIf="!isLoading && filteredRequests.length > 0" class="table-responsive">
          <table class="table table-hover align-middle">
            <thead class="table-primary">
              <tr>
                <th>SNo</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Reason</th>
                <th>Status</th>
                <th>
                  <span class="d-flex align-items-center gap-1" style="cursor: pointer;" (click)="toggleSort()">
                    Created On
                    <span *ngIf="sortOrder === 'asc'"><i class="bi bi-arrow-up"></i></span>
                    <span *ngIf="sortOrder === 'desc'"><i class="bi bi-arrow-down"></i></span>
                  </span>
                </th>
                <th>Leave Type</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leave of filteredRequests; let i = index">
                <td>{{(page - 1) * pageSize + i + 1}}</td>
                <td>{{formatDate(leave.startDate)}}</td>
                <td>{{formatDate(leave.endDate)}}</td>
                <td>{{leave.reason}}</td>
                <td>
                  <span class="badge" [ngClass]="getStatusBadgeClass(leave.status)">
                    {{leave.status}}
                  </span>
                </td>
                <td>{{formatDate(leave.createdOn)}}</td>
                <td>{{leave.leaveType}}</td>
                <td>
                  <button 
                    class="btn btn-sm btn-primary me-1"
                    (click)="editLeave(leave)"
                    [disabled]="!canEdit(leave.status)"
                    title="{{canEdit(leave.status) ? 'Edit' : 'Can only edit pending requests'}}">
                    <i class="bi bi-pencil"></i> Edit
                  </button>
                  <button 
                    class="btn btn-sm btn-danger"
                    (click)="openDeleteModal(leave._id || '')"
                    [disabled]="!canEdit(leave.status)"
                    title="{{canEdit(leave.status) ? 'Delete' : 'Can only delete pending requests'}}">
                    <i class="bi bi-trash"></i> Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination -->
          <div class="d-flex justify-content-center align-items-center mt-3">
            <button 
              class="btn btn-primary btn-sm me-2"
              (click)="previousPage()"
              [disabled]="page === 1">
              Prev
            </button>
            <span class="mx-3 small">Page {{page}} of {{totalPages}}</span>
            <button 
              class="btn btn-primary btn-sm ms-2"
              (click)="nextPage()"
              [disabled]="page === totalPages">
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        <p class="mb-0">Are you sure you want to delete this leave request?</p>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-sm btn-danger" data-bs-dismiss="modal" (click)="confirmDelete()">Yes, Delete</button>
      </div>
    </div>
  </div>
</div>

